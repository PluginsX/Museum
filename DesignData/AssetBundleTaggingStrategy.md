# 资产标签设置策略 - WebGL加载速度优化

## 一、策略概述

本策略旨在通过合理的资产标签分类和AssetBundle构建策略，优化WebGL发布后的文件加载速度，实现：
- 减少初始加载时间
- 实现按需加载
- 优化内存使用
- 提高资源加载效率

## 二、资产分类与标签体系

### 1. 基础标签（必选）

| 标签名称 | 描述 | 适用资产 |
|---------|------|----------|
| `core` | 核心必要资源，初始加载时必须立即可用 | 主场景、核心UI、关键脚本 |
| `level` | 关卡/场景相关资源 | 各个展览场景、场景特定模型 |
| `ui` | 用户界面资源 | UI图片、字体、动画 |
| `model` | 3D模型资源 | 文物模型、展示台、环境模型 |
| `texture` | 纹理资源 | 模型贴图、环境贴图、UI纹理 |
| `audio` | 音频资源 | 背景音乐、解说词、音效 |
| `animation` | 动画资源 | 模型动画、UI动画 |

### 2. 功能标签（可选）

| 标签名称 | 描述 | 适用资产 |
|---------|------|----------|
| `highres` | 高分辨率资源，可选择加载 | 高细节模型、4K纹理 |
| `lowres` | 低分辨率资源，用于快速加载 | 低多边形模型、压缩纹理 |
| `background` | 背景资源，可延迟加载 | 远处环境、背景贴图 |
| `interactive` | 交互相关资源 | 可交互文物、按钮音效 |
| `exhibit` | 展览内容资源 | 文物模型、解说音频 |

### 3. 加载时机标签

| 标签名称 | 描述 | 适用资产 |
|---------|------|----------|
| `preload` | 预加载资源 | 即将使用的下一场景资源 |
| `ondemand` | 按需加载资源 | 用户明确请求时才加载的内容 |
| `lazy` | 延迟加载资源 | 非关键、背景类资源 |

## 三、AssetBundle构建策略

### 1. Bundle分组原则

#### 核心Bundle（初始加载）
- 包含标签：`core`
- 内容：主场景、核心UI组件、必要脚本
- 大小控制：尽量控制在5-10MB以内

#### 场景Bundle（按场景分组）
- 包含标签：`level:[场景名]`
- 内容：特定场景的所有资源
- 构建方式：每个展览场景单独一个Bundle

#### 共享资源Bundle
- 包含标签：`shared`
- 内容：多个场景共用的模型、纹理、音效
- 构建方式：按资源类型（模型/纹理/音频）分组

#### UI资源Bundle
- 包含标签：`ui`
- 内容：所有UI相关资源
- 构建方式：按功能模块（主菜单/展览界面/设置等）分组

### 2. 资源压缩与优化

#### 纹理资源
- WebGL平台建议使用ASTC或ETC2压缩格式
- 为不同质量级别提供不同分辨率纹理
- 非透明纹理使用RGB格式，透明纹理使用RGBA
- 启用纹理压缩和Mipmap

#### 模型资源
- 优化模型面数，移除不必要的细节
- 使用LOD（细节层次）系统
- 合并静态模型以减少DrawCall

#### 音频资源
- 使用MP3或OGG格式
- 背景音乐：128kbps
- 音效：96kbps
- 长音频考虑流式加载

#### 动画资源
- 压缩动画曲线
- 移除不必要的动画轨迹
- 考虑使用动画重定向减少动画文件数量

## 四、加载策略实现

### 1. 初始加载
- 加载`core` Bundle
- 显示加载进度界面
- 预加载当前场景所需的`level` Bundle

### 2. 按需加载
- 用户进入特定展览区域时加载对应`exhibit`资源
- 用户交互触发时加载`interactive`资源
- 使用异步加载避免UI卡顿

### 3. 预加载策略
- 预测用户行为，提前加载下一个可能访问的展览内容
- 在用户浏览当前内容时，后台加载后续资源
- 监控网络状态，调整预加载策略

### 4. 资源卸载
- 离开场景时卸载不再需要的`level` Bundle
- 清理不再可见的UI资源
- 监控内存使用，及时释放未使用资源

## 五、WebGL特定优化

### 1. 构建设置优化
- 使用IL2CPP脚本后端
- 启用代码剥离（Managed Stripping Level设为High）
- 启用WebGL内存优化
- 调整WebGL模板，使用现代浏览器特性

### 2. 加载器优化
- 使用WebAssembly streaming编译
- 启用gzip或brotli压缩
- 实现渐进式加载
- 使用Service Worker缓存常用资源

### 3. 运行时优化
- 启用纹理流式加载
- 优化Canvas渲染设置
- 减少JavaScript与WebGL的通信次数
- 使用对象池减少GC

## 六、标签使用示例

### 1. 主场景资源
- 标签：`core`, `level:main`
- 说明：初始加载的核心场景

### 2. 文物模型
- 标签：`model`, `exhibit:terracotta`, `level:ancient_china`
- 说明：兵马俑文物模型，属于中国古代展厅

### 3. UI按钮图标
- 标签：`ui`, `texture`, `interactive`
- 说明：交互式UI元素的纹理

### 4. 背景音乐
- 标签：`audio`, `background`, `preload`
- 说明：需要预加载的背景音乐

## 七、实施步骤

1. **资产审计**：全面审查现有资产，按类型和用途分类
2. **标签规划**：为每个资产确定合适的标签组合
3. **标签实施**：在Unity编辑器中为资产添加标签
4. **Bundle配置**：使用AssetBundle Browser或脚本配置Bundle构建
5. **加载系统开发**：实现基于标签的资源加载系统
6. **测试与优化**：测试加载性能，调整标签和Bundle策略
7. **监控与迭代**：发布后监控加载性能，持续优化策略

## 八、工具推荐

- **AssetBundle Browser**：Unity官方工具，用于配置和管理AssetBundle
- **Profiler**：监控内存使用和加载性能
- **Texture Packer**：优化纹理图集
- **Mesh Simplifier**：优化模型面数
- **WebGL Memory Profiler**：专门用于WebGL内存分析

## 九、注意事项

1. 避免Bundle过大（建议单个Bundle不超过50MB）
2. 避免Bundle数量过多（增加HTTP请求开销）
3. 定期清理未使用的资产和标签
4. 为不同网络环境提供不同的加载策略
5. 测试在不同设备和浏览器上的加载性能

通过实施本策略，可以显著提高WebGL发布后的文件加载速度，提升用户体验，特别是在网络条件不佳的情况下。